<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Sheep! Heard Dan</title>
</head>
<body>
<embed src="https://raw.githubusercontent.com/brildon/dreamland_dan/master/music.wav" autostart="true" loop="true" hidden="true">
<div id="container" style="width:1500px; height:500px; position:relative;" >
    	<canvas id="ctx" width="1584" height="884" style="z-index:2"></canvas>
	<input type="text" style="left=200; top=300;" id="textboxOne"></input>
	<input type="text" style="left=300; top=300;" id="textboxTwo"></input>
	<input type="text" style="left=200; top=300;" id="textboxThree"></input>
	<input type="text" style="left=200; top=300;" id="textboxFour"></input>
	<input type="text" style="left=200; top=300;" id="textboxFive"></input>
	<input type="text" style="left=200; top=300;" id="textboxSix"></input>
</div>
<script>
var cv = document.getElementById("ctx");
var ctx = cv.getContext('2d');

var textboxOne = document.getElementById("textboxOne");
var textboxTwo = document.getElementById("textboxTwo");
var textboxThree = document.getElementById("textboxThree");
var textboxFour = document.getElementById("textboxFour");
var textboxFive = document.getElementById("textboxFive");
var textboxSix = document.getElementById("textboxSix");

	textboxOne.style.visibility='hidden';
	textboxTwo.style.visibility='hidden';
	textboxThree.style.visibility='hidden';
	textboxFour.style.visibility='hidden';
	textboxFive.style.visibility='hidden';
	textboxSix.style.visibility='hidden';

var sheepPoints = 6;	
var levelAt = 0;

var leftWords = [];
var rightWords = [];
var jumpWords = [];
var crouchWords = [];
var attackWords = [];

var menuCheck = true;
var buildCheck = false;
var collide = false;
var falling = false;
var isDucked = false;
var isStanding = true;

var regExpOne;
var regExpTwo;
var regExpThree;
var regExpFour;
var regExpFive;
var regExpSix;

var mouse = {x:0,y:0};

var collisionIndex = -1;

var key = [];

var gameWorld = {
	x: 0,
	y: 0,
	width: 6370,
	heigth: 884	
}

var camera = {
	x: 0,
	y: 0,
	width: cv.width,
	height: cv.height,
	
	rightInnerBoundary: function (){
		return this.x + (this.width * 0.75);	
	},	
	leftInnerBoundary: function (){
		return this.x+ (this.width * 0.25);	
	},
	topInnerBoundary: function (){
		return this.y + (this.height * 0.25);	
	},
	bottomInnerBoundary: function (){
		return this.y + (this.height * 0.75);	
	}
}

var collisionObj = {
	x: 0,
	y: 0,
	height: 10,
	width: 75,
	
	centerX: function (){
		return this.x + (this.width / 2);
	},
	centerY: function (){
		return this.y + (this.height / 2);	
	},
	halfWidth: function(){
		return (this.width / 2);	
	},
	halfHeight: function(){
		return (this.height / 2);	
	}	
}

var playerObj = {
	posY: 600,
	posX: 600,
	height: 137,
	width: 124,
	hMask: 10,
	wMask: 75,
	jumpStrength: 20,
	jumpDecay: 0.5,
	fallStrengh: 0,
	speed: 5,
	state: 0,
	
	centerX: function (){
		return this.posX + (this.wMask / 2);
	},
	centerY: function (){
		return this.posY + (this.height / 2);	
	},
	halfWidth: function(){
		return (this.wMask / 2);	
	},
	halfHeight: function(){
		return (this.height / 2);	
	}
}

var branchObj = {
	posX: 0,
	posY: 0,
	height: 5,
	width : 100,
	
	centerX: function (){
		return this.posX + (this.width / 2);
	},
	centerY: function (){
		return this.posY + (this.height / 2);	
	},
	halfWidth: function(){
		return (this.width / 2);	
	},
	halfHeight: function(){
		return (this.height / 2);	
	}		
}

var sheepObj = {
	posX: 0,
	posY: 0,
	height: 69,
	width : 124,
	saved: false,
	
	centerX: function (){
		return this.posX + (this.width / 2);
	},
	centerY: function (){
		return this.posY + (this.height / 2);	
	},
	halfWidth: function(){
		return (this.width / 2);	
	},
	halfHeight: function(){
		return (this.height / 2);	
	}		
}

var playerObj = Object.create(playerObj);

var sheep = new Array (6);
for (var i=0; i<sheep.length; i++)
{
	sheep[i]=Object.create(branchObj);
}

sheep[0].posX =750;
sheep[0].posY =650;
sheep[0].saved = false;

sheep[1].posX =1500 ;
sheep[1].posY =650;
sheep[1].saved = false;

sheep[2].posX =2500 ;
sheep[2].posY =650;
sheep[2].saved = false;

sheep[3].posX =3250;
sheep[3].posY =650;
sheep[3].saved = false;

sheep[4].posX =4000;
sheep[4].posY =650;
sheep[4].saved = false;

sheep[5].posX =4750;
sheep[5].posY =650;
sheep[5].saved = false;

var aBranch = new Array (10);
for (var i=0;i<aBranch.length;i++){
	aBranch[i] = Object.create(branchObj);	
}

aBranch[0].posX = 150;
aBranch[0].posY = 580;

aBranch[1].posX = 300;
aBranch[1].posY = 400;
	
aBranch[2].posX = 2450;
aBranch[2].posY = 580;

aBranch[3].posX = 0;
aBranch[3].posY = 737;
aBranch[3].width = gameWorld.width;

aBranch[4].posX = 150;
aBranch[4].posY = 220;

aBranch[5].posX = 500;
aBranch[5].posY = 450;

aBranch[6].posX = 800;
aBranch[6].posY = 500;

aBranch[7].posX = 1000;
aBranch[7].posY = 450;

aBranch[8].posX = 1200;
aBranch[8].posY = 400;

aBranch[9].posX = 1500;
aBranch[9].posY = 350;

var floorLvl = 737;

var box1 = new breakObj(800, 600, 50, 50, false);
var box2 = new breakObj(900, 600, 50, 50, false);

camera.x = (gameWorld.x + gameWorld.width/2) - camera.width/2;
camera.y = (gameWorld.y + gameWorld.height/2) - camera.height/2;

var isAttack = false;
var isDucking = false;
var isMoveLeft = false;
var isMoveRight = false;
var isJump = false;


// event listeners for key's and click's
window.addEventListener("keydown", keyDown, false);
window.addEventListener("keyup", keyUp, false);

//loadHandler();
var image = new Image();	
image.addEventListener("load", loadHandler, false);
image.src = "https://cloud.githubusercontent.com/assets/8835208/4764399/6fdf279c-5b24-11e4-8a22-14603b0af298.png";

var background = new Image();	
background.addEventListener("load", loadHandler, false);
background.src = "https://cloud.githubusercontent.com/assets/8864180/4765125/f531d2bc-5b35-11e4-97af-57fb880a6c3c.png";

var llama_left = new Image();	
var llama_right = new Image();
var llama_duck_left = new Image();
var llama_duck_right = new Image();
var sheep_right = new Image();
var sheep_left = new Image();
llama_duck_left.src = "https://cloud.githubusercontent.com/assets/8864180/4760667/dae888d6-5af1-11e4-91a3-e80853a2e7bf.png";
llama_duck_right.src = "https://cloud.githubusercontent.com/assets/8864180/4760665/dae0a92c-5af1-11e4-89f1-82140c195ae4.png";
llama_left.src = "https://cloud.githubusercontent.com/assets/8864180/4586896/82814c90-5020-11e4-992b-ad73f2ed03be.png";
llama_right.src = "https://cloud.githubusercontent.com/assets/8864180/4586897/8285871a-5020-11e4-94fd-a55f2a82e864.png";
sheep_right.src = "https://cloud.githubusercontent.com/assets/8864180/4760666/dae47cd2-5af1-11e4-8c89-d18d53fd4ad1.png";
sheep_left.src = "https://cloud.githubusercontent.com/assets/8864180/4760668/daec1546-5af1-11e4-8f05-72ddf1c0a71e.png";


function menu(e)
{
	var tempStartH;
	var tempStartW;
	
	if(e.layerX || e.layerY == 0){
		mouse.x = e.pageX - cv.offsetLeft;
		mouse.y = e.pageY - cv.offsetTop;	
	}
	
	if(mouse.x < 1102 && mouse.y < 512 && mouse.x > 813 && mouse.y > 402 && menuCheck==true)
	{
		buildCheck=false;
		menuCheck=false;
		loadHandler();
	}
}

function loadHandler()
{	
	if(menuCheck == true)
	{
		if(buildCheck == false)
		{
			ctx.drawImage(image,0,0,1600,900);
			buildCheck=true;		
		}
		document.onmousedown = menu;
	}
	else
	{	
		if(buildCheck == false)
		{
			buildCheck = true;
			
			textboxOne.style.visibility='visible';
			textboxTwo.style.visibility='visible';
			textboxThree.style.visibility='visible';
			textboxFour.style.visibility='visible';
			textboxFive.style.visibility='visible';
			textboxSix.style.visibility='visible';
			
			setInterval(gameScreen, 1000/50);
		}
	}
}

function gameScreen()
{
	update();
	
	side_scroller();
	
	render();
}

function side_scroller(){
	playerObj.posX = Math.max(0, Math.min(playerObj.posX, gameWorld.width - playerObj.width));
		
	camera.x = Math.floor(playerObj.posX + (playerObj.width/2) - (camera.width/2));
	camera.y = Math.floor(playerObj.posY + (playerObj.height/2) - (camera.height/2));
	
	if (playerObj.posX < camera.leftInnerBoundary()){
		camera.x = Math.floor(playerObj.posX - (camera.width * 0.25));	
	}
	if (playerObj.posY < camera.topInnerBoundary()){
		camera.y = Math.floor(playerObj.posY - (camera.height*0.25));	
	}
	if (playerObj.posX + playerObj.width > camera.rightInnerBoundary()){
		camera.x = Math.floor(playerObj.posX + playerObj.width - (camera.width *0.75));	
	}
	if (playerObj.posY + playerObj.height > camera.bottomInnerBoundary()){
		camera.y = Math.floor(playerObj.posY + playerObj.height - (camera.height * 0.75));
	}
	
	if (camera.x < gameWorld.x){
		camera.x = gameWorld.x;	
	}
	if (camera.y < gameWorld.y){
		camera.y = gameWorld.y;	
	}
	if (camera.x + camera.width > gameWorld.x + gameWorld.width){
		camera.x = gameWorld.x + gameWorld.width - camera.width;	
	}
	if (camera.y + camera.height > gameWorld.heigth){
		camera.y = gameWorld.heigth - camera.height;	
	}	
}

var test = false;

function update()
{
	var playerDirec = 0;
	
	collisionObj.x = playerObj.posX;
	collisionObj.y = (playerObj.posY + playerObj.height - collisionObj.height)+1;
	
	//SpaceBar
	if(key[32])
	{
		isAttack = true;
	}
	//W
	if(key[87])
	{
		if(!isJump)
		{
			playerObj.posY = playerObj.posY-1;
			isJump = true;
		}	
	}
	//A
	if(key[65])
	{
		isMoveLeft = true;
		playerObj.state = 1;
	}
	//S
	if(key[83])
	{
		isDucking = true;
	}
	//D
	if(key[68])
	{
		isMoveRight = true;
		playerObj.state = 0;
	}
	
	//SpaceBar
	if(!key[32])
	{
		isAttack = false;
	}
	//W
	
	//A 
	if(!key[65])
	{
		isMoveLeft = false;
	}
	//S
	if(!key[83])
	{
		isDucking = false;
	}
	//D
	if(!key[68])
	{
		isMoveRight = false;
	}
	
	// Preform actions
	if(isJump)
	{
			
		//Gravity equation...
		playerDirec = playerObj.jumpStrength - playerObj.jumpDecay
			
		// constantly updates playerOne's Y position
		playerObj.posY -= playerDirec;
		// constantly increases the amount of pull downwards by one. 
		playerObj.jumpDecay += 1;
					
		if (playerDirec < 0 ){ //caindo
			for (var i = 0; i< aBranch.length; i++){
				if (playerObj.posY > 600){
					floorLvl = 737;
					test = true;
				}
				if (hitTest(collisionObj,aBranch[i])){
					console.log ("hit");
					floorLvl = aBranch[i].posY;
					test = true;
				}
			}
		}
	
		if (test){
			playerObj.jumpDecay = .5;
			playerObj.jumpStrength = 20;
			playerObj.posY = (floorLvl-playerObj.height);
			playerDirec = 0;
			isJump = false;
			test = false;
			console.log("test");
		}
	}
	
	collide=false;
	for (var i = 0; i< aBranch.length; i++){
		if (hitTest(collisionObj,aBranch[i])){
				collide = true;	
				falling = false;
				collisionIndex = i;
				floorLvl = aBranch[i].posY;
		}
	}
	
	if (!collide&&!isJump){
		floorLvl=737;
		
		if (playerObj.posY<floorLvl)
		{
			if(!falling)
			{		
				playerObj.jumpDecay = 0.5;
				falling = true;
			}
			else
			{
				playerObj.posY+= playerObj.jumpDecay;
				playerObj.jumpDecay += 1;
				if (playerObj.posY >600){
					playerObj.posY = 600;	
				}
				
			}
		}
		else{
			falling = false;
		}
	}
	
	if(isMoveLeft)
	{
		playerObj.posX -= playerObj.speed;	
	}
	
	if(isMoveRight)
	{
		playerObj.posX += playerObj.speed;
	}
	
	if(isDucking)
	{
		isStanding = false;
		if (isDucked == false)
		{
			isDucked = true;	
			playerObj.height = 138/2;
			playerObj.posY = playerObj.posY + 69;
		}
	}
	if(!isDucking)
	{
		isDucked = false;
		if(isStanding == false)
		{
			isStanding = true;
			playerObj.height = 138;	
			playerObj.posY = playerObj.posY - 69;
		}
	}
	
	if(isAttack)
	{
		if(box1.posX <= (playerObj.posX + playerObj.width) && playerObj.posY == box1.posY && box1.posX >= playerObj.posX)
		{
			box1.broken = true;
		}
		if(box2.posX <= (playerObj.posX + playerObj.width) && playerObj.posY == box2.posY && box2.posX >= playerObj.posX)
		{
			box2.broken = true;
		}
	}
	
	for(var i=0; i<sheep.length; i++)
	{
		if(hitTest(playerObj,sheep[i]))
		{
			sheep[i].saved=true;
		}
	}
	
	render();
}

function hitTest(r1,r2){
	//console.log("testando");
	return Math.abs(r1.centerX() - r2.centerX()) < r1.halfWidth() + r2.halfWidth() && Math.abs(r1.centerY() - r2.centerY()) < r1.halfHeight()+r2.halfHeight();	
}

function render()
{
	ctx.clearRect(0,0,1600,900);
	
	ctx.save();
	ctx.translate(-camera.x, -camera.y);
	ctx.drawImage(background,0,0,6370,900);
	
	ctx.fillRect(collisionObj.x, collisionObj.y, collisionObj.width, collisionObj.height);
	
	if(!box1.broken)
	{
		ctx.fillRect(box1.posX, box1.posY, box1.width, box1.height);
	}
	if(!box2.broken)
	{
		ctx.fillRect(box2.posX, box2.posY, box2.width, box2.height);
	}
	
	if(playerObj.state == 0){
		if(isDucking)
			ctx.drawImage(llama_duck_right,playerObj.posX, playerObj.posY);
		else
			ctx.drawImage(llama_right,playerObj.posX, playerObj.posY);
	}
	if(playerObj.state == 1){
		if(isDucking)
			ctx.drawImage(llama_duck_left,playerObj.posX-43, playerObj.posY);
		else
			ctx.drawImage(llama_left,playerObj.posX-43, playerObj.posY);
	}
		
	for (var i=0;i<aBranch.length;i++){
		ctx.fillRect(aBranch[i].posX,aBranch[i].posY,aBranch[i].width,aBranch[i].height);	
	}
	
	if(isAttack)
	{
		ctx.fillStyle = 'green';
		ctx.fillRect(playerObj.posX + playerObj.width, playerObj.posY, playerObj.width/2, playerObj.height/4);
	}
	
	for (var i=0; i<sheep.length;i++)
	{
		if(sheep[i].saved==false)
		{
			ctx.drawImage(sheep_right,sheep[i].posX, sheep[i].posY);	
		}
		else
		{
			ctx.drawImage(sheep_left,sheep[i].posX, sheep[i].posY);
		}
	}
		
	ctx.restore();
}

function keyDown(e)
{
		key[e.keyCode] = true;
}

function keyUp(e)
{
		delete key[e.keyCode];
}

function breakObj(posX, posY, height, width, broken)
{
	this.posX = posX;
	this.posY = posY;
	this.height = height;
	this.width = width;
	this.broken = broken;
}
</script>
</body>
</html>
